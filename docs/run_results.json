{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.8.3", "generated_at": "2024-08-02T21:54:46.555927Z", "invocation_id": "c18e59e4-a196-4622-a660-36be64795cab", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-02T21:54:44.449020Z", "completed_at": "2024-08-02T21:54:44.450720Z"}, {"name": "execute", "started_at": "2024-08-02T21:54:44.463711Z", "completed_at": "2024-08-02T21:54:44.463720Z"}], "thread_id": "Thread-2", "execution_time": 0.029334068298339844, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.aws_cloud_cost_integration_tests.aws_cost_report", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-02T21:54:44.436340Z", "completed_at": "2024-08-02T21:54:45.363780Z"}, {"name": "execute", "started_at": "2024-08-02T21:54:45.364122Z", "completed_at": "2024-08-02T21:54:45.364131Z"}], "thread_id": "Thread-1", "execution_time": 1.0084688663482666, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.aws_cloud_cost.stg_aws_cloud_cost__report_base", "compiled": true, "compiled_code": "\n\n\n\n\nselect\n            \"_file\",\n  \"_line\",\n  \"_fivetran_synced\",\n  \"_modified\",\n  \"bill_bill_type\",\n  \"bill_billing_entity\",\n  \"bill_billing_period_end_date\",\n  \"bill_billing_period_start_date\",\n  \"bill_invoice_id\",\n  \"bill_invoicing_entity\",\n  \"bill_payer_account_id\",\n  \"identity_line_item_id\",\n  \"identity_time_interval\",\n  \"line_item_availability_zone\",\n  \"line_item_blended_cost\",\n  \"line_item_blended_rate\",\n  \"line_item_currency_code\",\n  \"line_item_legal_entity\",\n  \"line_item_line_item_description\",\n  \"line_item_line_item_type\",\n  \"line_item_normalization_factor\",\n  \"line_item_normalized_usage_amount\",\n  \"line_item_operation\",\n  \"line_item_product_code\",\n  \"line_item_resource_id\",\n  \"line_item_tax_type\",\n  \"line_item_unblended_cost\",\n  \"line_item_unblended_rate\",\n  \"line_item_usage_account_id\",\n  \"line_item_usage_amount\",\n  \"line_item_usage_end_date\",\n  \"line_item_usage_start_date\",\n  \"line_item_usage_type\",\n  \"pricing_currency\",\n  \"pricing_lease_contract_length\",\n  \"pricing_offering_class\",\n  \"pricing_public_on_demand_cost\",\n  \"pricing_public_on_demand_rate\",\n  \"pricing_purchase_option\",\n  \"pricing_rate_code\",\n  \"pricing_rate_id\",\n  \"pricing_term\",\n  \"pricing_unit\",\n  \"product_alarm_type\",\n  \"product_api_calls\",\n  \"product_availability\",\n  \"product_availability_zone\",\n  \"product_bundle\",\n  \"product_bundle_description\",\n  \"product_bundle_group\",\n  \"product_capacitystatus\",\n  \"product_category\",\n  \"product_ci_type\",\n  \"product_classicnetworkingsupport\",\n  \"product_clock_speed\",\n  \"product_compute_family\",\n  \"product_current_generation\",\n  \"product_data\",\n  \"product_database_edition\",\n  \"product_database_engine\",\n  \"product_datatransferout\",\n  \"product_dedicated_ebs_throughput\",\n  \"product_deployment_option\",\n  \"product_description\",\n  \"product_directory_size\",\n  \"product_directory_type\",\n  \"product_directory_type_description\",\n  \"product_durability\",\n  \"product_ecu\",\n  \"product_endpoint\",\n  \"product_endpoint_type\",\n  \"product_engine_code\",\n  \"product_enhanced_networking_supported\",\n  \"product_equivalentondemandsku\",\n  \"product_event_type\",\n  \"product_fee_code\",\n  \"product_fee_description\",\n  \"product_free_query_types\",\n  \"product_free_trial\",\n  \"product_from_location\",\n  \"product_from_location_type\",\n  \"product_from_region_code\",\n  \"product_gpu_memory\",\n  \"product_group\",\n  \"product_group_description\",\n  \"product_instance\",\n  \"product_instance_family\",\n  \"product_instance_type\",\n  \"product_instance_type_family\",\n  \"product_intel_avx_2_available\",\n  \"product_intel_avx_available\",\n  \"product_intel_turbo_available\",\n  \"product_io\",\n  \"product_license\",\n  \"product_license_model\",\n  \"product_location\",\n  \"product_location_type\",\n  \"product_logs_destination\",\n  \"product_marketoption\",\n  \"product_max_iops_burst_performance\",\n  \"product_max_iopsvolume\",\n  \"product_max_throughputvolume\",\n  \"product_max_volume_size\",\n  \"product_maximum_storage_volume\",\n  \"product_memory\",\n  \"product_memory_gib\",\n  \"product_message_delivery_frequency\",\n  \"product_message_delivery_order\",\n  \"product_min_volume_size\",\n  \"product_minimum_storage_volume\",\n  \"product_network_performance\",\n  \"product_normalization_size_factor\",\n  \"product_operating_system\",\n  \"product_operation\",\n  \"product_physical_processor\",\n  \"product_platopricingtype\",\n  \"product_platoprotocoltype\",\n  \"product_platostoragetype\",\n  \"product_platotrafficdirection\",\n  \"product_platousagetype\",\n  \"product_platovolumetype\",\n  \"product_pre_installed_sw\",\n  \"product_pricing_unit\",\n  \"product_processor_architecture\",\n  \"product_processor_features\",\n  \"product_product_family\",\n  \"product_product_name\",\n  \"product_product_type\",\n  \"product_provisioned\",\n  \"product_queue_type\",\n  \"product_region\",\n  \"product_region_code\",\n  \"product_request_type\",\n  \"product_resource_price_group\",\n  \"product_resource_type\",\n  \"product_rootvolume\",\n  \"product_routing_target\",\n  \"product_routing_type\",\n  \"product_running_mode\",\n  \"product_servicecode\",\n  \"product_servicename\",\n  \"product_size_flex\",\n  \"product_sku\",\n  \"product_software_included\",\n  \"product_steps\",\n  \"product_storage\",\n  \"product_storage_class\",\n  \"product_storage_family\",\n  \"product_storage_media\",\n  \"product_storage_type\",\n  \"product_tenancy\",\n  \"product_tiertype\",\n  \"product_to_location\",\n  \"product_to_location_type\",\n  \"product_to_region_code\",\n  \"product_transfer_type\",\n  \"product_type\",\n  \"product_type_description\",\n  \"product_usage_family\",\n  \"product_usagetype\",\n  \"product_uservolume\",\n  \"product_vcpu\",\n  \"product_version\",\n  \"product_volume_api_name\",\n  \"product_volume_type\",\n  \"product_vpcnetworkingsupport\",\n  \"product_with_active_users\",\n  \"reservation_amortized_upfront_fee_for_billing_period\",\n  \"reservation_end_time\",\n  \"reservation_modification_status\",\n  \"reservation_normalized_units_per_reservation\",\n  \"reservation_number_of_reservations\",\n  \"reservation_reservation_arn\",\n  \"reservation_start_time\",\n  \"reservation_subscription_id\",\n  \"reservation_total_reserved_normalized_units\",\n  \"reservation_total_reserved_units\",\n  \"reservation_units_per_reservation\",\n  \"reservation_unused_amortized_upfront_fee_for_billing_period\",\n  \"reservation_unused_normalized_unit_quantity\",\n  \"reservation_unused_quantity\",\n  \"reservation_unused_recurring_fee\",\n  \"reservation_upfront_value\",\n  \"resource_tags_user_department\",\n  \"resource_tags_user_eks_nodegroup_name\",\n  \"resource_tags_user_name\",\n  \"resource_tags_user_noncompliant_expires_on\",\n  \"resource_tags_user_noncompliant_no_department\",\n  \"resource_tags_user_noncompliant_no_owner\",\n  \"resource_tags_user_noncompliant_no_team\",\n  \"resource_tags_user_owner\",\n  \"resource_tags_user_team\",\n  \"resource_tags_user_unique_name\",\n  \"savings_plan_end_time\",\n  \"savings_plan_offering_type\",\n  \"savings_plan_payment_option\",\n  \"savings_plan_purchase_term\",\n  \"savings_plan_region\",\n  \"savings_plan_savings_plan_arn\",\n  \"savings_plan_savings_plan_effective_cost\",\n  \"savings_plan_savings_plan_rate\",\n  \"savings_plan_start_time\",\n  \"bill_payer_account_name\",\n  \"product_updates\",\n  \"product\",\n  \"product_extended_support_pricing_year\",\n  \"product_time_window\",\n  \"product_engine_major_version\",\n  \"product_engine\",\n  \"product_subservice\",\n  \"discount\",\n  \"resource_tags\",\n  \"cost_category\",\n  \"line_item_usage_account_name\",\n  \"product_describes\",\n  \"product_provider\",\n  \"product_invocation\",\n  \"product_pricingplan\",\n  \"product_ops_items\",\n  \"reservation_reservation_a_r_n\",\n  \"product_gets\",\n  \"reservation_recurring_fee_for_usage\",\n  \"savings_plan_recurring_commitment_for_billing_period\",\n  \"savings_plan_used_commitment\",\n  \"reservation_amortized_upfront_cost_for_usage\",\n  \"reservation_effective_cost\",\n  \"savings_plan_amortized_upfront_commitment_for_billing_period\",\n  \"savings_plan_total_commitment_to_date\"\n        from \"postgres\".\"aws_cloud_cost_docs\".\"aws_cost_report\" as source_table\n    \n    ", "relation_name": "\"postgres\".\"aws_cloud_cost_docs_aws_cloud_cost_dev\".\"stg_aws_cloud_cost__report_base\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-02T21:54:45.445474Z", "completed_at": "2024-08-02T21:54:46.400416Z"}, {"name": "execute", "started_at": "2024-08-02T21:54:46.400666Z", "completed_at": "2024-08-02T21:54:46.400675Z"}], "thread_id": "Thread-4", "execution_time": 1.0345118045806885, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.aws_cloud_cost.stg_aws_cloud_cost__report", "compiled": true, "compiled_code": "with base as (\n\n    select * \n    from \"postgres\".\"aws_cloud_cost_docs_aws_cloud_cost_dev\".\"stg_aws_cloud_cost__report_base\"\n),\n\nfields as (\n\n    select\n        \n    \n    \n    _file\n    \n as \n    \n    _file\n    \n, \n    \n    \n    _fivetran_synced\n    \n as \n    \n    _fivetran_synced\n    \n, \n    \n    \n    _line\n    \n as \n    \n    _line\n    \n, \n    \n    \n    _modified\n    \n as \n    \n    _modified\n    \n, \n    \n    \n    bill_bill_type\n    \n as \n    \n    bill_bill_type\n    \n, \n    \n    \n    bill_billing_entity\n    \n as \n    \n    bill_billing_entity\n    \n, \n    \n    \n    bill_billing_period_end_date\n    \n as \n    \n    bill_billing_period_end_date\n    \n, \n    \n    \n    bill_billing_period_start_date\n    \n as \n    \n    bill_billing_period_start_date\n    \n, \n    \n    \n    bill_invoice_id\n    \n as \n    \n    bill_invoice_id\n    \n, \n    \n    \n    bill_invoicing_entity\n    \n as \n    \n    bill_invoicing_entity\n    \n, \n    \n    \n    bill_payer_account_id\n    \n as \n    \n    bill_payer_account_id\n    \n, \n    \n    \n    bill_payer_account_name\n    \n as \n    \n    bill_payer_account_name\n    \n, \n    \n    \n    identity_line_item_id\n    \n as \n    \n    identity_line_item_id\n    \n, \n    \n    \n    identity_time_interval\n    \n as \n    \n    identity_time_interval\n    \n, \n    \n    \n    line_item_availability_zone\n    \n as \n    \n    line_item_availability_zone\n    \n, \n    \n    \n    line_item_blended_cost\n    \n as \n    \n    line_item_blended_cost\n    \n, \n    \n    \n    line_item_blended_rate\n    \n as \n    \n    line_item_blended_rate\n    \n, \n    \n    \n    line_item_currency_code\n    \n as \n    \n    line_item_currency_code\n    \n, \n    \n    \n    line_item_line_item_description\n    \n as \n    \n    line_item_line_item_description\n    \n, \n    \n    \n    line_item_line_item_type\n    \n as \n    \n    line_item_line_item_type\n    \n, \n    \n    \n    line_item_normalization_factor\n    \n as \n    \n    line_item_normalization_factor\n    \n, \n    \n    \n    line_item_normalized_usage_amount\n    \n as \n    \n    line_item_normalized_usage_amount\n    \n, \n    \n    \n    line_item_operation\n    \n as \n    \n    line_item_operation\n    \n, \n    \n    \n    line_item_product_code\n    \n as \n    \n    line_item_product_code\n    \n, \n    \n    \n    line_item_resource_id\n    \n as \n    \n    line_item_resource_id\n    \n, \n    \n    \n    line_item_tax_type\n    \n as \n    \n    line_item_tax_type\n    \n, \n    \n    \n    line_item_unblended_cost\n    \n as \n    \n    line_item_unblended_cost\n    \n, \n    \n    \n    line_item_unblended_rate\n    \n as \n    \n    line_item_unblended_rate\n    \n, \n    \n    \n    line_item_usage_account_id\n    \n as \n    \n    line_item_usage_account_id\n    \n, \n    \n    \n    line_item_usage_account_name\n    \n as \n    \n    line_item_usage_account_name\n    \n, \n    \n    \n    line_item_usage_amount\n    \n as \n    \n    line_item_usage_amount\n    \n, \n    \n    \n    line_item_usage_end_date\n    \n as \n    \n    line_item_usage_end_date\n    \n, \n    \n    \n    line_item_usage_start_date\n    \n as \n    \n    line_item_usage_start_date\n    \n, \n    \n    \n    line_item_usage_type\n    \n as \n    \n    line_item_usage_type\n    \n, \n    \n    \n    pricing_currency\n    \n as \n    \n    pricing_currency\n    \n, \n    \n    \n    pricing_public_on_demand_cost\n    \n as \n    \n    pricing_public_on_demand_cost\n    \n, \n    \n    \n    pricing_public_on_demand_rate\n    \n as \n    \n    pricing_public_on_demand_rate\n    \n, \n    \n    \n    pricing_purchase_option\n    \n as \n    \n    pricing_purchase_option\n    \n, \n    \n    \n    pricing_term\n    \n as \n    \n    pricing_term\n    \n, \n    \n    \n    pricing_unit\n    \n as \n    \n    pricing_unit\n    \n, \n    \n    \n    product_pricing_unit\n    \n as \n    \n    product_pricing_unit\n    \n, \n    \n    \n    product_fee_code\n    \n as \n    \n    product_fee_code\n    \n, \n    \n    \n    product_fee_description\n    \n as \n    \n    product_fee_description\n    \n, \n    \n    \n    product_from_location\n    \n as \n    \n    product_from_location\n    \n, \n    \n    \n    product_from_location_type\n    \n as \n    \n    product_from_location_type\n    \n, \n    \n    \n    product_from_region_code\n    \n as \n    \n    product_from_region_code\n    \n, \n    \n    \n    product_instance_family\n    \n as \n    \n    product_instance_family\n    \n, \n    \n    \n    product_instance_type\n    \n as \n    \n    product_instance_type\n    \n, \n    \n    \n    product_location\n    \n as \n    \n    product_location\n    \n, \n    \n    \n    product_location_type\n    \n as \n    \n    product_location_type\n    \n, \n    \n    \n    product_operation\n    \n as \n    \n    product_operation\n    \n, \n    \n    \n    product_product_name\n    \n as \n    \n    product_product_name\n    \n, \n    \n    \n    product_product_family\n    \n as \n    \n    product_product_family\n    \n, \n    \n    \n    product_region_code\n    \n as \n    \n    product_region_code\n    \n, \n    \n    \n    product_servicecode\n    \n as \n    \n    product_servicecode\n    \n, \n    \n    \n    product_to_location\n    \n as \n    \n    product_to_location\n    \n, \n    \n    \n    product_to_location_type\n    \n as \n    \n    product_to_location_type\n    \n, \n    \n    \n    product_to_region_code\n    \n as \n    \n    product_to_region_code\n    \n, \n    \n    \n    product_usagetype\n    \n as \n    \n    product_usagetype\n    \n, \n    \n    \n    reservation_amortized_upfront_cost_for_usage\n    \n as \n    \n    reservation_amortized_upfront_cost_for_usage\n    \n, \n    \n    \n    reservation_amortized_upfront_fee_for_billing_period\n    \n as \n    \n    reservation_amortized_upfront_fee_for_billing_period\n    \n, \n    \n    \n    reservation_effective_cost\n    \n as \n    \n    reservation_effective_cost\n    \n, \n    \n    \n    reservation_normalized_units_per_reservation\n    \n as \n    \n    reservation_normalized_units_per_reservation\n    \n, \n    \n    \n    reservation_number_of_reservations\n    \n as \n    \n    reservation_number_of_reservations\n    \n, \n    \n    \n    reservation_recurring_fee_for_usage\n    \n as \n    \n    reservation_recurring_fee_for_usage\n    \n, \n    \n    \n    reservation_total_reserved_normalized_units\n    \n as \n    \n    reservation_total_reserved_normalized_units\n    \n, \n    \n    \n    reservation_total_reserved_units\n    \n as \n    \n    reservation_total_reserved_units\n    \n, \n    \n    \n    reservation_units_per_reservation\n    \n as \n    \n    reservation_units_per_reservation\n    \n, \n    \n    \n    reservation_unused_amortized_upfront_fee_for_billing_period\n    \n as \n    \n    reservation_unused_amortized_upfront_fee_for_billing_period\n    \n, \n    \n    \n    reservation_unused_normalized_unit_quantity\n    \n as \n    \n    reservation_unused_normalized_unit_quantity\n    \n, \n    \n    \n    reservation_unused_quantity\n    \n as \n    \n    reservation_unused_quantity\n    \n, \n    \n    \n    reservation_unused_recurring_fee\n    \n as \n    \n    reservation_unused_recurring_fee\n    \n, \n    \n    \n    reservation_upfront_value\n    \n as \n    \n    reservation_upfront_value\n    \n, \n    \n    \n    savings_plan_amortized_upfront_commitment_for_billing_period\n    \n as \n    \n    savings_plan_amortized_upfront_commitment_for_billing_period\n    \n, \n    \n    \n    savings_plan_recurring_commitment_for_billing_period\n    \n as \n    \n    savings_plan_recurring_commitment_for_billing_period\n    \n, \n    \n    \n    savings_plan_savings_plan_effective_cost\n    \n as \n    \n    savings_plan_savings_plan_effective_cost\n    \n, \n    \n    \n    savings_plan_savings_plan_rate\n    \n as \n    \n    savings_plan_savings_plan_rate\n    \n, \n    \n    \n    savings_plan_total_commitment_to_date\n    \n as \n    \n    savings_plan_total_commitment_to_date\n    \n, \n    \n    \n    savings_plan_used_commitment\n    \n as \n    \n    savings_plan_used_commitment\n    \n\n\n\n        \n        \n, 'aws_cloud_cost_docs' || '.'|| 'aws_cloud_cost_docs' || '.'|| 'aws_cost_report' as source_relation\n\n    from base\n),\n\nfinal as (\n    \n    select \n        source_relation, \n        _file,\n        \n\nTRIM(BOTH '/' FROM (\n\n  \n    \n\n    split_part(\n        _file,\n        '/',\n        1\n        )\n\n\n  \n\n || '/' || \n\n  \n    \n\n    split_part(\n        _file,\n        '/',\n        2\n        )\n\n\n  \n\n)) as report,\n        _line,\n        _modified,\n        max(_modified) over (partition by bill_billing_period_start_date ) = _modified as is_latest_file_version,\n        bill_bill_type as bill_type,\n        bill_billing_entity as billing_entity,\n        bill_billing_period_start_date as billing_period_start_date,\n        bill_billing_period_end_date as billing_period_end_date,\n        bill_invoice_id as invoice_id,\n        bill_invoicing_entity as invoicing_entity,\n        bill_payer_account_id,\n        bill_payer_account_name,\n        line_item_blended_cost as blended_cost,\n        line_item_blended_rate as blended_rate,\n        line_item_currency_code as currency_code,\n        line_item_normalization_factor as normalization_factor,\n        line_item_normalized_usage_amount as normalized_usage_amount,\n        line_item_availability_zone as availability_zone,\n        line_item_line_item_description as line_item_description,\n        line_item_line_item_type as line_item_type,\n        line_item_tax_type as tax_type,\n        coalesce(line_item_operation, product_operation) as operation,\n        line_item_product_code as product_code,\n        line_item_unblended_cost as unblended_cost,\n        line_item_unblended_rate as unblended_rate,\n        line_item_usage_account_id as usage_account_id,\n        line_item_usage_account_name as usage_account_name,\n        line_item_usage_amount as usage_amount,\n        line_item_usage_end_date as usage_end_date,\n        line_item_usage_start_date as usage_start_date,\n        line_item_usage_type as usage_type,\n        pricing_public_on_demand_cost as public_on_demand_cost,\n        pricing_public_on_demand_rate as public_on_demand_rate,\n        pricing_purchase_option as purchase_option,\n        pricing_term,\n        coalesce(pricing_unit, product_pricing_unit) as pricing_unit,\n        product_fee_code, \n        product_fee_description,\n\n        -- info about product\n        product_product_name as product_name,\n        product_product_family as product_family,\n        product_servicecode as product_service_code,\n\n        -- instances \n        product_instance_type as instance_type,\n        product_instance_family as instance_family,\n\n        -- Location data for s3 buckets\n        product_location as location,\n        product_location_type as location_type,\n        product_region_code as region_code,\n\n        -- Location data for data movement (maybe remove from defaults?)\n        product_from_location as from_location,\n        product_from_location_type as from_location_type,\n        product_from_region_code as from_region_code,\n        product_to_location as to_location,\n        product_to_location_type as to_location_type,\n        product_to_region_code as to_region_code,\n\n        -- default: only include reservation + savings plan numeric fields, dimensions can be added via passthroughs\n        reservation_amortized_upfront_cost_for_usage,\n        reservation_amortized_upfront_fee_for_billing_period,\n        reservation_effective_cost,\n        reservation_number_of_reservations as number_of_reservations,\n        reservation_normalized_units_per_reservation as normalized_units_per_reservation,\n        reservation_units_per_reservation as units_per_reservation,\n        reservation_total_reserved_normalized_units as total_reserved_normalized_units,\n        reservation_total_reserved_units as total_reserved_units,\n        reservation_recurring_fee_for_usage,\n        reservation_unused_amortized_upfront_fee_for_billing_period,\n        reservation_unused_normalized_unit_quantity,\n        reservation_unused_quantity,\n        reservation_unused_recurring_fee,\n        reservation_upfront_value,\n        savings_plan_amortized_upfront_commitment_for_billing_period,\n        savings_plan_recurring_commitment_for_billing_period,\n        savings_plan_savings_plan_effective_cost as savings_plan_effective_cost,\n        savings_plan_savings_plan_rate as savings_plan_rate,\n        savings_plan_total_commitment_to_date,\n        savings_plan_used_commitment \n\n        \n\n\n\n\n\n    from fields\n)\n\nselect *\nfrom final\nwhere is_latest_file_version\nand billing_period_start_date >= '1970-01-01'", "relation_name": "\"postgres\".\"aws_cloud_cost_docs_aws_cloud_cost_dev\".\"stg_aws_cloud_cost__report\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-02T21:54:46.480525Z", "completed_at": "2024-08-02T21:54:46.512164Z"}, {"name": "execute", "started_at": "2024-08-02T21:54:46.512405Z", "completed_at": "2024-08-02T21:54:46.512412Z"}], "thread_id": "Thread-2", "execution_time": 0.03270912170410156, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.aws_cloud_cost.aws_cloud_cost__daily_overview", "compiled": true, "compiled_code": "\n\nwith source_report as (\n\n    select *\n    from \"postgres\".\"aws_cloud_cost_docs_aws_cloud_cost_dev\".\"stg_aws_cloud_cost__report\"\n),\n\n\nusage_account_mapping as (\n\n    select \n        usage_account_id,\n        usage_account_name,\n        source_relation,\n        max(usage_start_date) as latest_start_date\n\n    from source_report\n    where usage_account_name is not null\n    group by 1,2,3\n),\n\nusage_account_names as (\n\n    select\n        sub.usage_account_id,\n        sub.usage_account_name,\n        sub.source_relation\n    from (\n        \n        select \n            usage_account_id,\n            usage_account_name,\n            source_relation,\n            row_number() over (partition by usage_account_id  order by latest_start_date desc) = 1 as is_latest_name\n        from usage_account_mapping\n    ) as sub where is_latest_name\n),\n\n\nbilling_account_mapping as (\n\n    select \n        bill_payer_account_id,\n        bill_payer_account_name,\n        source_relation,\n        max(billing_period_start_date) as latest_start_date\n\n    from source_report\n    where bill_payer_account_name is not null\n    group by 1,2,3\n),\n\nbilling_account_names as (\n\n    select\n        sub.bill_payer_account_id,\n        sub.bill_payer_account_name,\n        sub.source_relation\n    from (\n        \n        select \n            bill_payer_account_id,\n            bill_payer_account_name,\n            source_relation,\n            row_number() over (partition by bill_payer_account_id  order by latest_start_date desc) = 1 as is_latest_name\n        from billing_account_mapping\n    ) as sub where is_latest_name\n),\n\nfields as (\n\n    select \n        source_report.source_relation,\n        report, \n\n        \n        cast(date_trunc('day', usage_start_date) as date) as usage_start_date,\n        cast(date_trunc('day', usage_end_date) as date) as usage_end_date,\n        billing_period_start_date,\n        billing_period_end_date,\n\n        \n        source_report.usage_account_id,\n        coalesce(source_report.usage_account_name, usage_account_names.usage_account_name) as usage_account_name,\n        source_report.bill_payer_account_id,\n        coalesce(source_report.bill_payer_account_name, billing_account_names.bill_payer_account_name) as bill_payer_account_name,\n\n        \n        invoice_id,\n        invoicing_entity,\n        billing_entity,\n        bill_type, \n        line_item_type,\n        tax_type,\n\n        \n        purchase_option,\n        pricing_term,\n        product_fee_code,\n        product_fee_description,\n\n        \n        pricing_unit,\n        usage_type,\n        currency_code,\n        \n        \n        line_item_description,\n        product_code,\n        product_name,\n        product_service_code, -- service is within product\n        product_family,\n        operation,\n\n        \n        instance_type,\n        instance_family,\n\n        \n        location,\n        location_type,\n        region_code,\n        availability_zone,\n\n        \n        from_location,\n        from_location_type,\n        from_region_code,\n        to_location,\n        to_location_type,\n        to_region_code\n\n        \n\n\n\n,\n\n        \n        cast(sum(coalesce(usage_amount, 0)) as numeric(28,6)) as usage_amount,\n        cast(sum(coalesce(normalized_usage_amount, 0)) as numeric(28,6)) as normalized_usage_amount,\n        cast(max(normalization_factor) as numeric(28,6)) as normalization_factor,\n\n        \n        cast(sum(coalesce(blended_cost, 0)) as numeric(28,6)) as blended_cost,\n        cast(sum(coalesce(unblended_cost, 0)) as numeric(28,6)) as unblended_cost,\n        cast(sum(coalesce(public_on_demand_cost, 0)) as numeric(28,6)) as public_on_demand_cost,\n        cast(avg(blended_rate) as numeric(28,6)) as avg_blended_rate,\n        cast(avg(unblended_rate) as numeric(28,6)) as avg_unblended_rate,\n        cast(avg(public_on_demand_rate) as numeric(28,6)) as avg_public_on_demand_rate,\n        cast(count(*) as numeric(28,6)) as count_line_items,\n\n        \n        cast(max(reservation_amortized_upfront_cost_for_usage) as numeric(28,6)) as reservation_amortized_upfront_cost_for_usage,\n        cast(max(reservation_amortized_upfront_fee_for_billing_period) as numeric(28,6)) as reservation_amortized_upfront_fee_for_billing_period,\n        cast(max(reservation_effective_cost) as numeric(28,6)) as reservation_effective_cost,\n        cast(max(number_of_reservations) as numeric(28,6)) as number_of_reservations,\n        cast(max(normalized_units_per_reservation) as numeric(28,6)) as normalized_units_per_reservation,\n        cast(max(units_per_reservation) as numeric(28,6)) as units_per_reservation,\n        cast(max(total_reserved_normalized_units) as numeric(28,6)) as total_reserved_normalized_units,\n        cast(max(total_reserved_units) as numeric(28,6)) as total_reserved_units,\n        \n        cast(max(reservation_recurring_fee_for_usage) as numeric(28,6)) as reservation_recurring_fee_for_usage,\n        cast(min(reservation_unused_amortized_upfront_fee_for_billing_period) as numeric(28,6)) as reservation_unused_amortized_upfront_fee_for_billing_period,\n        cast(min(reservation_unused_normalized_unit_quantity) as numeric(28,6)) as reservation_unused_normalized_unit_quantity,\n        cast(min(reservation_unused_quantity) as numeric(28,6)) as reservation_unused_quantity,\n        cast(min(reservation_unused_recurring_fee) as numeric(28,6)) as reservation_unused_recurring_fee,\n        cast(max(reservation_upfront_value) as numeric(28,6)) as reservation_upfront_value,\n\n        \n        cast(max(savings_plan_amortized_upfront_commitment_for_billing_period) as numeric(28,6)) as savings_plan_amortized_upfront_commitment_for_billing_period,\n        cast(max(savings_plan_recurring_commitment_for_billing_period) as numeric(28,6)) as savings_plan_recurring_commitment_for_billing_period,\n        cast(max(savings_plan_effective_cost) as numeric(28,6)) as savings_plan_effective_cost,\n        cast(max(savings_plan_rate) as numeric(28,6)) as savings_plan_rate,\n        cast(max(savings_plan_total_commitment_to_date) as numeric(28,6)) as savings_plan_total_commitment_to_date,\n        cast(max(savings_plan_used_commitment) as numeric(28,6)) as savings_plan_used_commitment \n\n    from source_report\n    left join billing_account_names\n        on source_report.bill_payer_account_id = billing_account_names.bill_payer_account_id\n        and source_report.source_relation = billing_account_names.source_relation\n    left join usage_account_names\n        on source_report.usage_account_id = usage_account_names.usage_account_id\n        and source_report.source_relation = usage_account_names.source_relation\n\n    group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41\n),\n\nfinal as (\nselect \n        *, \n        md5(cast(coalesce(cast(source_relation as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(report as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(usage_start_date as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(usage_end_date as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(billing_period_start_date as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(billing_period_end_date as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(usage_account_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(usage_account_name as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(bill_payer_account_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(bill_payer_account_name as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(invoice_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(invoicing_entity as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(billing_entity as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(bill_type as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(line_item_type as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(tax_type as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(purchase_option as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(pricing_term as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(product_fee_code as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(product_fee_description as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(pricing_unit as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(usage_type as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(currency_code as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(line_item_description as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(product_code as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(product_service_code as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(product_name as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(product_family as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(operation as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(instance_family as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(instance_type as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(location as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(location_type as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(region_code as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(availability_zone as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(from_location as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(from_location_type as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(from_region_code as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(to_location as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(to_location_type as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(to_region_code as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as unique_key\n    from fields\n)\n\nselect *\nfrom final", "relation_name": "\"postgres\".\"aws_cloud_cost_docs_aws_cloud_cost_dev\".\"aws_cloud_cost__daily_overview\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-02T21:54:46.515418Z", "completed_at": "2024-08-02T21:54:46.536841Z"}, {"name": "execute", "started_at": "2024-08-02T21:54:46.537369Z", "completed_at": "2024-08-02T21:54:46.537374Z"}], "thread_id": "Thread-3", "execution_time": 0.023861169815063477, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.aws_cloud_cost.aws_cloud_cost__daily_instance_report", "compiled": true, "compiled_code": "\n\nwith base as (\n\n    select *\n    from \"postgres\".\"aws_cloud_cost_docs_aws_cloud_cost_dev\".\"aws_cloud_cost__daily_overview\"\n),\n\nfields as (\n\n    select \n        source_relation,\n        report,\n        usage_start_date as usage_date,\n        billing_period_start_date,\n        billing_period_end_date,\n        usage_account_id,\n        usage_account_name,\n        bill_payer_account_id,\n        bill_payer_account_name,\n        currency_code,\n        usage_type,\n\n        \n\n        count(distinct product_service_code) as count_products,\n        count(distinct region_code) as count_regions,\n        sum(coalesce(usage_amount, 0)) as usage_amount,\n        sum(coalesce(normalized_usage_amount, 0)) as normalized_usage_amount,\n        sum(coalesce(total_reserved_units, 0)) as total_reserved_units, -- use this for size-flexible Reserved Instances\n        sum(coalesce(blended_cost, 0)) as total_blended_cost,\n        sum(coalesce(unblended_cost, 0)) as total_unblended_cost,\n        sum(coalesce(public_on_demand_cost, 0)) as total_public_on_demand_cost\n\n        \n        \n    from base \n    group by 1,2,3,4,5,6,7,8,9,10,11\n),\n\nfinal as (\n\n    select\n        *,\n        \n        md5(cast(coalesce(cast(source_relation as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(report as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(usage_date as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(billing_period_start_date as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(billing_period_end_date as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(usage_account_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(usage_account_name as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(bill_payer_account_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(bill_payer_account_name as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(currency_code as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(usage_type as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as unique_key\n    from fields\n)\n\nselect *\nfrom final", "relation_name": "\"postgres\".\"aws_cloud_cost_docs_aws_cloud_cost_dev\".\"aws_cloud_cost__daily_instance_report\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-02T21:54:46.520774Z", "completed_at": "2024-08-02T21:54:46.537144Z"}, {"name": "execute", "started_at": "2024-08-02T21:54:46.537798Z", "completed_at": "2024-08-02T21:54:46.537802Z"}], "thread_id": "Thread-4", "execution_time": 0.023536205291748047, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.aws_cloud_cost.aws_cloud_cost__daily_product_report", "compiled": true, "compiled_code": "\n\nwith base as (\n\n    select *\n    from \"postgres\".\"aws_cloud_cost_docs_aws_cloud_cost_dev\".\"aws_cloud_cost__daily_overview\"\n),\n\nfields as (\n\n    select \n        source_relation,\n        report,\n        usage_start_date as usage_date,\n        billing_period_start_date,\n        billing_period_end_date,\n        usage_account_id,\n        usage_account_name,\n        bill_payer_account_id,\n        bill_payer_account_name,\n        currency_code,\n        product_code,\n        product_name,\n\n        \n\n        count(distinct region_code) as count_regions,\n        count(distinct usage_type) as count_instances,\n        sum(coalesce(usage_amount, 0)) as usage_amount,\n        sum(coalesce(normalized_usage_amount, 0)) as normalized_usage_amount,\n        sum(coalesce(total_reserved_units, 0)) as total_reserved_units, -- use this for size-flexible Reserved Instances\n        sum(coalesce(blended_cost, 0)) as total_blended_cost,\n        sum(coalesce(unblended_cost, 0)) as total_unblended_cost,\n        sum(coalesce(public_on_demand_cost, 0)) as total_public_on_demand_cost\n\n        \n\n    from base \n    group by 1,2,3,4,5,6,7,8,9,10,11,12\n),\n\nfinal as (\n\n    select\n        *,\n        \n        md5(cast(coalesce(cast(source_relation as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(report as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(usage_date as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(billing_period_start_date as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(billing_period_end_date as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(usage_account_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(usage_account_name as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(bill_payer_account_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(bill_payer_account_name as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(currency_code as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(product_code as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(product_name as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as unique_key\n    from fields\n)\n\nselect *\nfrom final", "relation_name": "\"postgres\".\"aws_cloud_cost_docs_aws_cloud_cost_dev\".\"aws_cloud_cost__daily_product_report\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-02T21:54:46.525738Z", "completed_at": "2024-08-02T21:54:46.538326Z"}, {"name": "execute", "started_at": "2024-08-02T21:54:46.538867Z", "completed_at": "2024-08-02T21:54:46.538872Z"}], "thread_id": "Thread-1", "execution_time": 0.02414989471435547, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.aws_cloud_cost.not_null_aws_cloud_cost__daily_overview_unique_key.ffdd51a6a3", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect unique_key\nfrom \"postgres\".\"aws_cloud_cost_docs_aws_cloud_cost_dev\".\"aws_cloud_cost__daily_overview\"\nwhere unique_key is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-02T21:54:46.531985Z", "completed_at": "2024-08-02T21:54:46.538596Z"}, {"name": "execute", "started_at": "2024-08-02T21:54:46.539705Z", "completed_at": "2024-08-02T21:54:46.539708Z"}], "thread_id": "Thread-2", "execution_time": 0.024755239486694336, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.aws_cloud_cost.unique_aws_cloud_cost__daily_overview_unique_key.b9df28f070", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    unique_key as unique_field,\n    count(*) as n_records\n\nfrom \"postgres\".\"aws_cloud_cost_docs_aws_cloud_cost_dev\".\"aws_cloud_cost__daily_overview\"\nwhere unique_key is not null\ngroup by unique_key\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-02T21:54:46.542025Z", "completed_at": "2024-08-02T21:54:46.552489Z"}, {"name": "execute", "started_at": "2024-08-02T21:54:46.553131Z", "completed_at": "2024-08-02T21:54:46.553136Z"}], "thread_id": "Thread-3", "execution_time": 0.012891054153442383, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.aws_cloud_cost.not_null_aws_cloud_cost__daily_instance_report_unique_key.da6e4d2a1c", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect unique_key\nfrom \"postgres\".\"aws_cloud_cost_docs_aws_cloud_cost_dev\".\"aws_cloud_cost__daily_instance_report\"\nwhere unique_key is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-02T21:54:46.544589Z", "completed_at": "2024-08-02T21:54:46.552702Z"}, {"name": "execute", "started_at": "2024-08-02T21:54:46.553501Z", "completed_at": "2024-08-02T21:54:46.553505Z"}], "thread_id": "Thread-4", "execution_time": 0.013006925582885742, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.aws_cloud_cost.unique_aws_cloud_cost__daily_instance_report_unique_key.564598b2b4", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    unique_key as unique_field,\n    count(*) as n_records\n\nfrom \"postgres\".\"aws_cloud_cost_docs_aws_cloud_cost_dev\".\"aws_cloud_cost__daily_instance_report\"\nwhere unique_key is not null\ngroup by unique_key\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-02T21:54:46.547223Z", "completed_at": "2024-08-02T21:54:46.552908Z"}, {"name": "execute", "started_at": "2024-08-02T21:54:46.553844Z", "completed_at": "2024-08-02T21:54:46.553847Z"}], "thread_id": "Thread-1", "execution_time": 0.012871980667114258, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.aws_cloud_cost.not_null_aws_cloud_cost__daily_product_report_unique_key.491d2fff1d", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect unique_key\nfrom \"postgres\".\"aws_cloud_cost_docs_aws_cloud_cost_dev\".\"aws_cloud_cost__daily_product_report\"\nwhere unique_key is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-08-02T21:54:46.549852Z", "completed_at": "2024-08-02T21:54:46.554165Z"}, {"name": "execute", "started_at": "2024-08-02T21:54:46.554516Z", "completed_at": "2024-08-02T21:54:46.554519Z"}], "thread_id": "Thread-2", "execution_time": 0.012939214706420898, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.aws_cloud_cost.unique_aws_cloud_cost__daily_product_report_unique_key.0f1e33814d", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    unique_key as unique_field,\n    count(*) as n_records\n\nfrom \"postgres\".\"aws_cloud_cost_docs_aws_cloud_cost_dev\".\"aws_cloud_cost__daily_product_report\"\nwhere unique_key is not null\ngroup by unique_key\nhaving count(*) > 1\n\n\n", "relation_name": null}], "elapsed_time": 5.044250726699829, "args": {"log_file_max_bytes": 10485760, "populate_cache": true, "profiles_dir": "/Users/jamie.rodriguez/.dbt", "log_path": "/Users/jamie.rodriguez/Desktop/dbt_repos/AWS_Cloud_Cost/dbt_aws_cloud_cost/integration_tests/logs", "introspect": true, "require_explicit_package_overrides_for_builtin_materializations": true, "favor_state": false, "log_level": "info", "indirect_selection": "eager", "printer_width": 80, "vars": {}, "cache_selected_only": false, "empty_catalog": false, "static": false, "warn_error_options": {"include": [], "exclude": []}, "select": [], "version_check": true, "which": "generate", "log_format_file": "debug", "write_json": true, "show_resource_report": false, "defer": false, "macro_debugging": false, "enable_legacy_logger": false, "send_anonymous_usage_stats": true, "partial_parse": true, "invocation_command": "dbt docs generate", "strict_mode": false, "quiet": false, "require_resource_names_without_spaces": false, "static_parser": true, "log_format": "default", "partial_parse_file_diff": true, "print": true, "source_freshness_run_project_hooks": false, "project_dir": "/Users/jamie.rodriguez/Desktop/dbt_repos/AWS_Cloud_Cost/dbt_aws_cloud_cost/integration_tests", "compile": true, "use_colors": true, "exclude": [], "log_level_file": "debug", "use_colors_file": true}}